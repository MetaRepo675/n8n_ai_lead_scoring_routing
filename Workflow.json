{
  "name": "AI Lead Scoring & Routing",
  "nodes": [
    {
      "parameters": {
        "path": "lead-form-webhook",
        "responseMode": "onReceived",
        "responseData": "allEntries",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "ğŸ“¥ Webhook (Form Data)",
      "type": "n8n-nodes-base.webhookTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "jsCode": "// Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ ÙˆØ±ÙˆØ¯ÛŒ\nconst item = $input.first().json;\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø¹ØªØ¨Ø§Ø±\nlet isValid = true;\nlet errorMessages = [];\n\n// Ø¨Ø±Ø±Ø³ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ\nconst requiredFields = ['fullName', 'email', 'message'];\nfor (const field of requiredFields) {\n  if (!item[field] || item[field].trim() === '') {\n    isValid = false;\n    errorMessages.push(`ÙÛŒÙ„Ø¯ ${field} Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø§Ø³Øª.`);\n  }\n}\n\n// Ù†Ø±Ù…Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ\nconst normalizedEmail = item.email ? item.email.toLowerCase().trim() : '';\nconst normalizedName = item.fullName ? item.fullName.trim() : '';\nconst normalizedMessage = item.message ? item.message.trim() : '';\n\n// ØªØ´Ø®ÛŒØµ Ø§ÛŒÙ…ÛŒÙ„ Ø´Ø±Ú©ØªÛŒ (Ù„ÛŒØ³Øª Ø³Ø§Ø¯Ù‡ Ø¯Ø§Ù…Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ)\nconst publicDomains = ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', 'aol.com'];\nlet isCompanyEmail = true;\nif (normalizedEmail) {\n  const domain = normalizedEmail.split('@')[1];\n  if (publicDomains.includes(domain)) {\n    isCompanyEmail = false;\n  }\n} else {\n  isCompanyEmail = false;\n}\n\n// Ø·ÙˆÙ„ Ù¾ÛŒØ§Ù…\nconst messageLength = normalizedMessage.length;\n\n// Ø®Ø±ÙˆØ¬ÛŒ\nreturn [{\n  json: {\n    ...item,\n    fullName: normalizedName,\n    email: normalizedEmail,\n    message: normalizedMessage,\n    isValid: isValid,\n    errorMessages: errorMessages,\n    isCompanyEmail: isCompanyEmail,\n    messageLength: messageLength,\n    receivedAt: new Date().toISOString()\n  }\n}];"
      },
      "id": "validation-enrichment",
      "name": "ğŸ” Validation & Enrichment",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true
          },
          "conditions": [
            {
              "id": "is-valid-check",
              "leftValue": "={{ $json[\"isValid\"] }}",
              "rightValue": "=true",
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "if-valid",
      "name": "ğŸ”€ Is Data Valid?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "jsCode": "// Ø«Ø¨Øª Ø®Ø·Ø§ Ø¯Ø± Ø´ÛŒØª Ú¯ÙˆÚ¯Ù„ (Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§ÛŒÙ†Ø¬Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª HTTP Ø¨Ù‡ Google Sheets Ø¨Ø²Ù†ÛŒØ¯)\n// Ø§Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒØŒ ÙÙ‚Ø· Ø®Ø·Ø§ Ø±Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ù„Ø§Ú¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…\nconst item = $input.first().json;\nconsole.error('Invalid lead data:', item);\n\n// Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® Ø®Ø·Ø§ Ø¨Ù‡ ÙˆØ¨â€ŒÙ‡ÙˆÚ©\nreturn [{\n  json: {\n    status: 'error',\n    message: 'Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ù… Ù†Ø§Ù‚Øµ Ø§Ø³Øª.',\n    errors: item.errorMessages\n  }\n}];"
      },
      "id": "error-handler",
      "name": "âš ï¸ Log Error & Respond",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [850, 150]
    },
    {
      "parameters": {
        "jsCode": "// Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ\nconst item = $input.first().json;\n\n// Ø³Ø§Ø®Øª Ù¾Ø±Ø§Ù…Ù¾Øª\nconst prompt = `\nØ¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ù„ÛŒØ¯ ÙØ±ÙˆØ´ Ø¹Ù…Ù„ Ú©Ù†.\nÙ¾ÛŒØ§Ù… Ø²ÛŒØ± Ø±Ø§ Ø§Ø² Ù…Ø´ØªØ±ÛŒ ØªØ­Ù„ÛŒÙ„ Ú©Ù† Ùˆ ÛŒÚ© Ø§Ù…ØªÛŒØ§Ø² Û° ØªØ§ Û±Û°Û° Ø¨Ø¯Ù‡.\nØ§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ù„Ø§ Ø¨Ù‡ Ù…Ø¹Ù†ÛŒ Ù¾ØªØ§Ù†Ø³ÛŒÙ„ Ø¨Ø§Ù„Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ø§Ø³Øª.\nÙ‡Ù…Ú†Ù†ÛŒÙ† intent (Ù‡Ø¯Ù) Ù…Ø´ØªØ±ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù† (Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…Ù…Ú©Ù†: ÙØ±ÙˆØ´, Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ, Ø¹Ù…ÙˆÙ…ÛŒ).\nØ¯Ø± Ù†Ù‡Ø§ÛŒØª ÛŒÚ© Ø®Ù„Ø§ØµÙ‡ Ú©ÙˆØªØ§Ù‡ Ø§Ø² Ù†ÛŒØ§Ø² Ù…Ø´ØªØ±ÛŒ Ø¨Ù†ÙˆÛŒØ³.\n\nØ§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ:\nÙ†Ø§Ù…: ${item.fullName}\nØ§ÛŒÙ…ÛŒÙ„: ${item.email}\nÙ¾ÛŒØ§Ù…: ${item.message}\n\nØ®Ø±ÙˆØ¬ÛŒ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª JSON Ø¨Ø§ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ score, intent, summary Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†.\n`;\n\nreturn [{\n  json: {\n    ...item,\n    aiPrompt: prompt\n  }\n}];"
      },
      "id": "prepare-ai-prompt",
      "name": "ğŸ¤– Prepare AI Prompt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "resource": "chat",
        "model": "gpt-4",
        "chatMessages": {
          "values": [
            {
              "role": "user",
              "content": "={{ $json.aiPrompt }}"
            }
          ]
        },
        "options": {
          "responseFormat": "json_object"
        }
      },
      "id": "openai-scoring",
      "name": "ğŸ§  OpenAI Scoring",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1050, 300],
      "credentials": {
        "openAiApi": "YOUR_OPENAI_CREDENTIALS_NAME"
      }
    },
    {
      "parameters": {
        "jsCode": "// Ù¾Ø§Ø±Ø³ Ú©Ø±Ø¯Ù† Ø®Ø±ÙˆØ¬ÛŒ JSON Ø§Ø² OpenAI\nconst item = $input.first().json;\nlet aiResult;\ntry {\n  aiResult = JSON.parse(item.message.content);\n} catch (e) {\n  // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§ÛŒÙ…Ù†\n  aiResult = { score: 0, intent: 'Ø¹Ù…ÙˆÙ…ÛŒ', summary: 'Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø±' };\n}\n\n// Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯Ù‡ score\nlet score = parseInt(aiResult.score);\nif (isNaN(score) || score < 0) score = 0;\nif (score > 100) score = 100;\n\n// ØªØ±Ú©ÛŒØ¨ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ\nreturn [{\n  json: {\n    ...item,\n    aiScore: score,\n    aiIntent: aiResult.intent || 'Ø¹Ù…ÙˆÙ…ÛŒ',\n    aiSummary: aiResult.summary || ''\n  }\n}];"
      },
      "id": "parse-ai-result",
      "name": "ğŸ”§ Parse AI Result",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true
          },
          "conditions": [
            {
              "id": "score-high",
              "leftValue": "={{ $json.aiScore }}",
              "rightValue": "=80",
              "operator": {
                "type": "number",
                "operation": "largerEqual"
              }
            }
          ]
        }
      },
      "id": "if-high-score",
      "name": "ğŸ”€ Score >= 80?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true
          },
          "conditions": [
            {
              "id": "score-medium",
              "leftValue": "={{ $json.aiScore }}",
              "rightValue": "=40",
              "operator": {
                "type": "number",
                "operation": "largerEqual"
              }
            }
          ]
        }
      },
      "id": "if-medium-score",
      "name": "ğŸ”€ Score 40-79?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1650, 400]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.hubapi.com/crm/v3/objects/deals",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "properties",
              "value": "={ \"dealname\": {{ $json.fullName }} - {{ $json.aiIntent }}, \"amount\": null, \"pipeline\": \"default\", \"dealstage\": \"appointmentscheduled\", \"hs_lead_status\": \"NEW\", \"hs_object_source\": \"INTEGRATION\", \"description\": {{ $json.aiSummary }} }"
            }
          ]
        },
        "options": {}
      },
      "id": "hubspot-create",
      "name": "ğŸ¢ HubSpot Create Deal",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1650, 150],
      "credentials": {
        "httpHeaderAuth": "YOUR_HUBSPOT_API_KEY"
      }
    },
    {
      "parameters": {
        "channel": "webhook",
        "webhookUri": "YOUR_SLACK_WEBHOOK_URL",
        "text": "ğŸ”” *Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ù„Ø§*\n*Ù†Ø§Ù…:* {{ $json.fullName }}\n*Ø§ÛŒÙ…ÛŒÙ„:* {{ $json.email }}\n*Ø§Ù…ØªÛŒØ§Ø²:* {{ $json.aiScore }}\n*Ù‡Ø¯Ù:* {{ $json.aiIntent }}\n*Ø®Ù„Ø§ØµÙ‡:* {{ $json.aiSummary }}"
      },
      "id": "slack-notify",
      "name": "ğŸ’¬ Slack Notification",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [1850, 150]
    },
    {
      "parameters": {
        "sheetId": {
          "__rl": true,
          "value": "YOUR_GOOGLE_SHEET_ID",
          "mode": "id"
        },
        "dataMode": "define",
        "values": {
          "string": [
            {
              "name": "fullName",
              "value": "={{ $json.fullName }}"
            },
            {
              "name": "email",
              "value": "={{ $json.email }}"
            },
            {
              "name": "message",
              "value": "={{ $json.message }}"
            },
            {
              "name": "aiScore",
              "value": "={{ $json.aiScore }}"
            },
            {
              "name": "aiIntent",
              "value": "={{ $json.aiIntent }}"
            },
            {
              "name": "aiSummary",
              "value": "={{ $json.aiSummary }}"
            },
            {
              "name": "receivedAt",
              "value": "={{ $json.receivedAt }}"
            }
          ]
        }
      },
      "id": "google-sheets-medium",
      "name": "ğŸ“Š Google Sheets (Medium)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [1850, 400]
    },
    {
      "parameters": {
        "message": {
          "to": "={{ $json.email }}",
          "subject": "Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§",
          "html": "<p>{{ $json.fullName }} Ø¹Ø²ÛŒØ²ØŒ</p><p>Ø¨Ø§ ØªØ´Ú©Ø± Ø§Ø² Ù¾ÛŒØ§Ù… Ø´Ù…Ø§. ØªÛŒÙ… Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§Ø³Øª Ùˆ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø¨Ø§ Ø´Ù…Ø§ ØªÙ…Ø§Ø³ Ø®ÙˆØ§Ù‡Ø¯ Ú¯Ø±ÙØª.</p><p>Ø¨Ø§ Ø§Ø­ØªØ±Ø§Ù…ØŒ<br>ØªÛŒÙ… ÙØ±ÙˆØ´</p>"
        },
        "operation": "draft"
      },
      "id": "gmail-draft",
      "name": "âœ‰ï¸ Gmail Create Draft",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 1,
      "position": [2050, 400],
      "credentials": {
        "gmailOAuth2": "YOUR_GMAIL_CREDENTIALS"
      }
    },
    {
      "parameters": {
        "jsCode": "// Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ú©Ù…â€ŒØ§Ù…ØªÛŒØ§Ø² (Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÛŒØ§ Ø´ÛŒØª Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯)\nconst item = $input.first().json;\nconsole.log('Low-score lead archived:', item.email);\nreturn [{\n  json: {\n    ...item,\n    archived: true\n  }\n}];"
      },
      "id": "archive-low",
      "name": "ğŸ“¦ Archive Low Score",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1850, 600]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true
          },
          "conditions": [
            {
              "id": "always-true",
              "leftValue": "=1",
              "rightValue": "=1",
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "noop-fallback",
      "name": "â¡ï¸ Fallback (End)",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [2050, 600]
    }
  ],
  "connections": {
    "ğŸ“¥ Webhook (Form Data)": {
      "main": [
        [
          {
            "node": "ğŸ” Validation & Enrichment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Validation & Enrichment": {
      "main": [
        [
          {
            "node": "ğŸ”€ Is Data Valid?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Is Data Valid?": {
      "main": [
        [
          {
            "node": "ğŸ¤– Prepare AI Prompt",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âš ï¸ Log Error & Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– Prepare AI Prompt": {
      "main": [
        [
          {
            "node": "ğŸ§  OpenAI Scoring",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ§  OpenAI Scoring": {
      "main": [
        [
          {
            "node": "ğŸ”§ Parse AI Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”§ Parse AI Result": {
      "main": [
        [
          {
            "node": "ğŸ”€ Score >= 80?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Score >= 80?": {
      "main": [
        [
          {
            "node": "ğŸ¢ HubSpot Create Deal",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ”€ Score 40-79?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Score 40-79?": {
      "main": [
        [
          {
            "node": "ğŸ“Š Google Sheets (Medium)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“¦ Archive Low Score",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¢ HubSpot Create Deal": {
      "main": [
        [
          {
            "node": "ğŸ’¬ Slack Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¬ Slack Notification": {
      "main": [
        [
          {
            "node": "â¡ï¸ Fallback (End)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Google Sheets (Medium)": {
      "main": [
        [
          {
            "node": "âœ‰ï¸ Gmail Create Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœ‰ï¸ Gmail Create Draft": {
      "main": [
        [
          {
            "node": "â¡ï¸ Fallback (End)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¦ Archive Low Score": {
      "main": [
        [
          {
            "node": "â¡ï¸ Fallback (End)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "pinData": {},
  "versionId": "1.0.0",
  "triggerCount": 1
}
